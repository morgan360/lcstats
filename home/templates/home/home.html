{% extends "_base.html" %}
{% block title %}Home | LCAI Maths{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">

    <!-- Hero Section -->
    <div style="text-align: center; margin-bottom: 60px; padding: 40px 20px;">
        <h1 style="font-size: 4.5em; margin: 0 0 20px 0; font-weight: 700; color: #004aad; letter-spacing: -2px;">
            LCAI Maths
        </h1>
        <p style="font-size: 1.3em; max-width: 800px; margin: 0 auto; color: #555; line-height: 1.6;">
            Master Leaving Certificate Honours Maths with AI-powered interactive practice questions,
            instant feedback, and personalized learning.
        </p>
    </div>

    <!-- News & Announcements Section -->
    {% if news_items %}
    <div style="margin-bottom: 40px;">
        <h2 style="color: #004aad; margin-bottom: 20px; text-align: center;">News & Announcements</h2>
        {% for item in news_items %}
        <div id="news-{{ item.id }}" style="background-color: #fff; border: 2px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 20px; position: relative; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <!-- Category and Pinned Badges -->
            <div style="margin-bottom: 10px;">
                {% if item.is_pinned %}
                <span style="background: linear-gradient(135deg, #ff6b6b, #ee5a52); color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.85em; font-weight: 600; margin-right: 8px; display: inline-block;">
                    üìå PINNED
                </span>
                {% endif %}
                {% if item.category == 'new_content' %}
                <span style="background: #4caf50; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.85em; font-weight: 600; display: inline-block;">
                    {{ item.get_category_display }}
                </span>
                {% elif item.category == 'tips' %}
                <span style="background: #ff9800; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.85em; font-weight: 600; display: inline-block;">
                    {{ item.get_category_display }}
                </span>
                {% elif item.category == 'system' %}
                <span style="background: #9c27b0; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.85em; font-weight: 600; display: inline-block;">
                    {{ item.get_category_display }}
                </span>
                {% elif item.category == 'event' %}
                <span style="background: #f44336; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.85em; font-weight: 600; display: inline-block;">
                    {{ item.get_category_display }}
                </span>
                {% else %}
                <span style="background: #2196f3; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.85em; font-weight: 600; display: inline-block;">
                    {{ item.get_category_display }}
                </span>
                {% endif %}
            </div>

            <!-- Title -->
            <h3 style="color: #333; margin: 10px 0; font-size: 1.4em;">{{ item.title }}</h3>

            <!-- Content -->
            <div style="color: #555; line-height: 1.7; margin: 15px 0;">
                {{ item.content_html }}
            </div>

            <!-- Date -->
            <div style="color: #999; font-size: 0.9em; margin-top: 15px;">
                <em>{{ item.publish_date|date:"F j, Y" }}</em>
            </div>

            <!-- Dismiss Button (only for logged-in users and dismissible items) -->
            {% if user.is_authenticated and item.is_dismissible %}
            <button onclick="dismissNews({{ item.id }})"
                    style="position: absolute; top: 15px; right: 15px; background: #e74c3c; color: white; border: none; padding: 6px 12px; cursor: pointer; border-radius: 4px; font-size: 0.85em; font-weight: 600; transition: background 0.3s;">
                ‚úï Dismiss
            </button>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <script>
    function dismissNews(newsId) {
        if (!confirm('Dismiss this news item? You won\'t see it again.')) return;

        fetch(`/news/dismiss/${newsId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const newsElement = document.getElementById(`news-${newsId}`);
                newsElement.style.transition = 'opacity 0.3s';
                newsElement.style.opacity = '0';
                setTimeout(() => newsElement.remove(), 300);
            } else {
                alert(data.error || 'Could not dismiss this item');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred');
        });
    }
    </script>
    {% endif %}

    <!-- Welcome Section -->
    {% if user.is_authenticated %}
    <div style="text-align: center; margin-bottom: 50px;">
        <div style="background-color: #e8f5e9; border: 2px solid #00994c; border-radius: 12px; padding: 40px;">
            <h2 style="color: #00994c; margin: 0 0 15px 0; font-size: 2em;">Welcome back, {{ user.username }}!</h2>
            <p style="margin: 0; font-size: 1.2em; color: #333;">Ready to continue your learning journey? Use the navigation menu above to get started.</p>
        </div>
    </div>
    {% endif %}

    <!-- Features Grid -->
    <div style="margin-bottom: 50px;">
        <h2 style="color: #004aad; margin-bottom: 30px; text-align: center; font-size: 2em;">Why LCAI Maths?</h2>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
            <div style="background-color: white; border: 2px solid #e0e0e0; border-radius: 10px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s;">
                <div style="font-size: 2.5em; margin-bottom: 15px;">üìö</div>
                <h3 style="color: #004aad; margin: 0 0 10px 0; font-size: 1.3em;">{{ total_questions }} Practice Questions</h3>
                <p style="margin: 0; line-height: 1.6; color: #555;">
                    Comprehensive coverage of all LC Honours Maths topics with multi-part questions and exam papers.
                </p>
            </div>

            <div style="background-color: white; border: 2px solid #e0e0e0; border-radius: 10px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s;">
                <div style="font-size: 2.5em; margin-bottom: 15px;">ü§ñ</div>
                <h3 style="color: #00994c; margin: 0 0 10px 0; font-size: 1.3em;">AI-Powered Feedback</h3>
                <p style="margin: 0; line-height: 1.6; color: #555;">
                    Instant intelligent grading with detailed explanations for your mathematical answers.
                </p>
            </div>

            <div style="background-color: white; border: 2px solid #e0e0e0; border-radius: 10px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s;">
                <div style="font-size: 2.5em; margin-bottom: 15px;">üí°</div>
                <h3 style="color: #cc0000; margin: 0 0 10px 0; font-size: 1.3em;">Smart Hints & Solutions</h3>
                <p style="margin: 0; line-height: 1.6; color: #555;">
                    Contextual hints and step-by-step solutions to help you understand the methodology.
                </p>
            </div>

            <div style="background-color: white; border: 2px solid #e0e0e0; border-radius: 10px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s;">
                <div style="font-size: 2.5em; margin-bottom: 15px;">üìä</div>
                <h3 style="color: #ff9800; margin: 0 0 10px 0; font-size: 1.3em;">Track Your Progress</h3>
                <p style="margin: 0; line-height: 1.6; color: #555;">
                    Detailed analytics across topics with performance tracking and improvement insights.
                </p>
            </div>

            <div style="background-color: white; border: 2px solid #e0e0e0; border-radius: 10px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s;">
                <div style="font-size: 2.5em; margin-bottom: 15px;">‚è±Ô∏è</div>
                <h3 style="color: #9c27b0; margin: 0 0 10px 0; font-size: 1.3em;">Timed Exam Practice</h3>
                <p style="margin: 0; line-height: 1.6; color: #555;">
                    Full exam papers with authentic timing to prepare you for the real experience.
                </p>
            </div>

            <div style="background-color: white; border: 2px solid #e0e0e0; border-radius: 10px; padding: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s;">
                <div style="font-size: 2.5em; margin-bottom: 15px;">üë•</div>
                <h3 style="color: #009688; margin: 0 0 10px 0; font-size: 1.3em;">{{ active_users_count }} Active Learners</h3>
                <p style="margin: 0; line-height: 1.6; color: #555;">
                    Join a community of students mastering LC Maths together.
                </p>
            </div>
        </div>
    </div>

    <!-- Topics Preview Section -->
    <div style="background-color: #fafafa; padding: 30px; border-radius: 8px; margin-top: 40px;">
        <h2 style="color: #004aad; text-align: center; margin-bottom: 25px;">Available Topics</h2>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            {% for topic in topics_with_counts %}
                {% cycle '#004aad' '#00994c' '#cc0000' '#ff9800' '#9c27b0' '#009688' '#3f51b5' '#e91e63' as border_color silent %}
                <div style="background-color: white; padding: 15px; border-radius: 6px; border-left: 4px solid {{ border_color }}; text-align: center;">
                    <strong>{{ topic.name }}</strong><br>
                    <span style="color: #666; font-size: 0.9em;">{{ topic.question_count }} question{{ topic.question_count|pluralize }}</span>
                </div>
            {% endfor %}
        </div>
    </div>

</div>
{% endblock %}
