{% extends '_base.html' %}
{% load static %}

{% block title %}Statistical Sampling Simulator - LCAI Maths{% endblock %}

{% block content %}
<div class="max-w-8xl px-4 py-8 sm:px-6 lg:px-8">
    <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between mb-4">
        <div>
            <h1 class="text-3xl font-semibold text-mist items-center">Statistical Sampling Simulator</h1>
            <p class="mt-2 text-lg text-mist/80">Explore the Central Limit Theorem through interactive visualization.
            </p>
        </div>
        <button id="helpButton"
            class="inline-flex items-center gap-2 self-start rounded-lg bg-gradient-to-r from-rose-pop to-violet-royal px-4 py-2 text-sm font-semibold text-mist shadow-[0_12px_24px_rgba(148,72,176,0.28)] transition hover:-translate-y-0.5 hover:shadow-[0_16px_30px_rgba(148,72,176,0.34)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-royal">
            <span
                class="flex h-6 w-6 items-center justify-center rounded-full bg-white text-violet-royal font-semibold">?</span>
            Help
        </button>
    </div>

    <!-- Control Panel -->
    <div class="mt-6 rounded-2xl border border-indigo-deep/10 bg-white/90 p-6 shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
            <div class="flex flex-col gap-2">
                <label for="meanInput" class="text-sm font-semibold text-midnight">Population Mean (Œº)</label>
                <input type="number" id="meanInput" value="16" step="1" min="-100" max="100"
                    class="w-full rounded-lg border border-indigo-deep/15 bg-white px-3 py-2 text-midnight shadow-inner focus:border-indigo-deep/50 focus:outline-none focus:ring-2 focus:ring-indigo-deep/20">
            </div>

            <div class="flex flex-col gap-2">
                <label for="sdInput" class="text-sm font-semibold text-midnight">Standard Deviation (œÉ)</label>
                <input type="number" id="sdInput" value="5" step="0.5" min="0.1" max="50"
                    class="w-full rounded-lg border border-indigo-deep/15 bg-white px-3 py-2 text-midnight shadow-inner focus:border-indigo-deep/50 focus:outline-none focus:ring-2 focus:ring-indigo-deep/20">
            </div>

            <div class="flex flex-col gap-2">
                <label for="sampleSize" class="text-sm font-semibold text-midnight">Sample Size (n)</label>
                <select id="sampleSize"
                    class="w-full rounded-lg border border-indigo-deep/15 bg-white px-3 py-2 text-midnight shadow-inner focus:border-indigo-deep/50 focus:outline-none focus:ring-2 focus:ring-indigo-deep/20">
                    <option value="1">Single Sample (n=1)</option>
                    <option value="5" selected>5 Samples</option>
                    <option value="10">10 Samples</option>
                    <option value="100">100 Samples</option>
                    <option value="1000">1,000 Samples</option>
                    <option value="10000">10,000 Samples</option>
                </select>
            </div>
        </div>

        <div class="mt-5 flex flex-wrap gap-3">
            <button
                class="inline-flex items-center justify-center gap-2 rounded-lg bg-gradient-01 px-4 py-2 text-sm font-semibold text-midnight shadow-[0_12px_24px_rgba(148,72,176,0.28)] transition hover:-translate-y-0.5 hover:shadow-[0_16px_30px_rgba(148,72,176,0.34)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-royal"
                id="generateSample">
                Generate Sample
            </button>
            <button
                class="inline-flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-rose-pop to-violet-royal px-4 py-2 text-sm font-semibold text-mist shadow-[0_12px_24px_rgba(148,72,176,0.28)] transition hover:-translate-y-0.5 hover:shadow-[0_16px_30px_rgba(148,72,176,0.34)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-royal"
                id="clearAll">
                Clear All
            </button>
            <button
                class="inline-flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-indigo-deep to-midnight px-4 py-2 text-sm font-semibold text-mist shadow-[0_12px_24px_rgba(0,0,0,0.2)] transition hover:-translate-y-0.5 hover:shadow-[0_16px_30px_rgba(0,0,0,0.26)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-deep"
                id="playAnimation">
                ‚ñ∂ Play Animation
            </button>
            <button
                class="hidden inline-flex items-center justify-center gap-2 rounded-lg bg-gradient-to-r from-midnight to-indigo-deep px-4 py-2 text-sm font-semibold text-mist shadow-[0_12px_24px_rgba(0,0,0,0.2)] transition hover:-translate-y-0.5 hover:shadow-[0_16px_30px_rgba(0,0,0,0.26)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-deep"
                id="pauseAnimation">
                ‚è∏ Pause
            </button>
        </div>

        <div id="animationControls"
            class="mt-4 hidden items-center gap-3 rounded-xl border border-indigo-deep/10 bg-mist px-4 py-3 text-sm text-midnight">
            <label for="animationSpeed" class="font-semibold text-midnight">Animation Speed:</label>
            <input type="range" id="animationSpeed" min="1" max="10" value="3" step="1"
                class="h-2 w-full max-w-xs cursor-pointer accent-violet-royal">
            <span id="speedDisplay" class="font-semibold text-indigo-deep">3x</span>
        </div>
    </div>

    <!-- Statistics Display -->
    <div class="mt-6 rounded-2xl border border-indigo-deep/10 bg-white/90 p-6 shadow-[0_12px_28px_rgba(0,0,0,0.08)]"
        id="statsDisplay">
        <h3 class="mb-4 text-xl font-semibold text-midnight">Current Statistics</h3>
        <div class="grid gap-10 sm:grid-cols-2 lg:grid-cols-4">
            <div
                class="flex items-center justify-between rounded-lg border-l-4 border-indigo-deep/60 bg-mist/70 px-4 py-3">
                <span class="text-sm font-semibold text-indigo-deep/80">Samples Taken</span>
                <span class="text-xl font-bold text-midnight" id="samplesCount">0</span>
            </div>
            <div
                class="flex items-center justify-between rounded-lg border-l-4 border-indigo-deep/60 bg-mist/70 px-4 py-3">
                <span class="text-sm font-semibold text-indigo-deep/80">Sample Mean</span>
                <span class="text-xl font-bold text-midnight" id="sampleMean">‚Äî</span>
            </div>
            <div
                class="flex items-center justify-between rounded-lg border-l-4 border-indigo-deep/60 bg-mist/70 px-4 py-3">
                <span class="text-sm font-semibold text-indigo-deep/80">Sample SD</span>
                <span class="text-xl font-bold text-midnight" id="sampleSd">‚Äî</span>
            </div>
            <div
                class="flex items-center justify-between rounded-lg border-l-4 border-indigo-deep/60 bg-mist/70 px-4 py-3">
                <span class="text-sm font-semibold text-indigo-deep/80">SE of Mean</span>
                <span class="text-xl font-bold text-midnight" id="standardError">‚Äî</span>
            </div>
        </div>
    </div>

    <!-- Graph 1: Parent Population -->
    <div class="mt-6 rounded-2xl border border-indigo-deep/10 bg-white/90 p-6 shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
        <div class="mb-4 flex flex-col gap-2">
            <h2 class="text-xl font-semibold text-midnight">Parent Population Distribution</h2>
            <p class="text-sm text-indigo-deep/80">
                Normal distribution with mean Œº = <span id="displayMean" class="font-semibold text-midnight">16</span>
                and standard deviation œÉ = <span id="displaySd" class="font-semibold text-midnight">5</span>
                <span class="ml-2 text-indigo-deep"
                    title="This is the population from which we draw samples. In a normal distribution, about 68% of values fall within 1œÉ of the mean, 95% within 2œÉ, and 99.7% within 3œÉ.">‚ÑπÔ∏è</span>
            </p>
        </div>
        <div id="populationPlot" class="h-[340px] w-full rounded-xl bg-mist"></div>
    </div>

    <!-- Graph 2: Sample Data -->
    <div class="mt-6 rounded-2xl border border-indigo-deep/10 bg-white/90 p-6 shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
        <div class="mb-4 flex flex-col gap-2">
            <h2 class="text-xl font-semibold text-midnight">Sample Data</h2>
            <p class="text-sm text-indigo-deep/80">
                Individual values drawn from the parent population
                <span class="ml-2 text-indigo-deep"
                    title="Each point represents a randomly drawn value from the population distribution. Watch how they vary around the population mean!">‚ÑπÔ∏è</span>
            </p>
        </div>
        <div id="samplePlot" class="h-[340px] w-full rounded-xl bg-mist"></div>
    </div>

    <!-- Graph 3: Distribution of Sample Means -->
    <div class="mt-6 rounded-2xl border border-indigo-deep/10 bg-white/90 p-6 shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
        <div class="mb-4 flex flex-col gap-2">
            <h2 class="text-xl font-semibold text-midnight">Distribution of Sample Means</h2>
            <p class="text-sm text-indigo-deep/80">
                Histogram of means from repeated sampling (Central Limit Theorem)
                <span class="ml-2 text-indigo-deep"
                    title="The Central Limit Theorem states that the distribution of sample means approaches a normal distribution as sample size increases, regardless of the population distribution. The standard error = œÉ/‚àön.">‚ÑπÔ∏è</span>
            </p>
        </div>
        <div id="samplingDistributionPlot" class="h-[340px] w-full rounded-xl bg-mist"></div>

        <div id="cltInfo" class="mt-5 hidden rounded-xl border-l-4 border-lime-glow bg-lime-glow/20 px-5 py-4">
            <h4 class="mb-4 text-lg font-semibold text-midnight">üéØ Central Limit Theorem in Action!</h4>

            <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                <div class="rounded-lg border border-indigo-deep/10 bg-white px-4 py-3 shadow-sm">
                    <div class="text-xs font-semibold uppercase tracking-wide text-indigo-deep/70">Population Mean (Œº)
                    </div>
                    <div class="text-2xl font-bold text-indigo-deep" id="populationMean">‚Äî</div>
                </div>

                <div class="rounded-lg border border-indigo-deep/10 bg-white px-4 py-3 shadow-sm">
                    <div class="text-xs font-semibold uppercase tracking-wide text-indigo-deep/70">Observed Mean of
                        Sample Means</div>
                    <div class="text-xl font-bold text-midnight" id="observedMean">‚Äî</div>
                </div>

                <div class="rounded-lg border border-indigo-deep/10 bg-white px-4 py-3 shadow-sm">
                    <div class="text-xs font-semibold uppercase tracking-wide text-indigo-deep/70">Observed SD of Sample
                        Means</div>
                    <div class="text-xl font-bold text-midnight" id="observedSD">‚Äî</div>
                </div>

                <div class="rounded-lg border border-rose-pop/30 bg-rose-pop/10 px-4 py-3 shadow-sm">
                    <div class="text-xs font-semibold uppercase tracking-wide text-indigo-deep/70">Standard Error
                        Formula</div>
                    <div class="text-2xl font-bold text-rose-pop">SE = œÉ/‚àön</div>
                </div>

                <div class="rounded-lg border border-indigo-deep/10 bg-white px-4 py-3 shadow-sm">
                    <div class="text-xs font-semibold uppercase tracking-wide text-indigo-deep/70">SE Calculation</div>
                    <div class="font-mono text-lg font-semibold text-midnight"><span id="seFormula">‚Äî</span> = <span
                            id="seCalculation">‚Äî</span></div>
                </div>
            </div>

            <p class="mt-3 text-sm leading-relaxed text-indigo-deep/90">
                <strong class="text-midnight">Notice:</strong> As you take more samples:
                <br>‚Ä¢ The observed mean converges to Œº (population mean)
                <br>‚Ä¢ The observed SD converges to SE (standard error)
                <br>This demonstrates the Central Limit Theorem!
            </p>
        </div>
    </div>
</div>

<!-- Help Modal -->
<div id="helpModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
    <div
        class="modal-content relative w-full max-w-3xl rounded-2xl bg-white px-6 py-6 shadow-[0_18px_45px_rgba(0,0,0,0.2)]">
        <button
            class="close absolute right-4 top-3 text-2xl font-bold text-indigo-deep/70 transition hover:text-midnight"
            aria-label="Close help">&times;</button>
        <h2 class="mb-4 text-2xl font-semibold text-midnight">How to Use the Statistical Sampling Simulator</h2>

        <h3 class="mt-4 text-lg font-semibold text-indigo-deep">üìä What This Tool Shows</h3>
        <p class="text-sm leading-relaxed text-midnight">This simulator demonstrates the <strong>Central Limit Theorem
                (CLT)</strong>, one of the most important concepts in statistics.</p>

        <h3 class="mt-4 text-lg font-semibold text-indigo-deep">üéÆ Controls</h3>
        <ul class="list-disc space-y-1 pl-5 text-sm leading-relaxed text-midnight">
            <li><strong>Population Mean (Œº):</strong> The average value of the entire population</li>
            <li><strong>Standard Deviation (œÉ):</strong> How spread out the population values are</li>
            <li><strong>Sample Size (n):</strong> How many values to draw in each sample</li>
            <li><strong>Generate Sample:</strong> Take a random sample and update graphs</li>
            <li><strong>Play Animation:</strong> Automatically take repeated samples to see the CLT in action</li>
            <li><strong>Clear All:</strong> Reset everything and start over</li>
        </ul>

        <h3 class="mt-4 text-lg font-semibold text-indigo-deep">üìà The Three Graphs</h3>
        <ol class="list-decimal space-y-1 pl-5 text-sm leading-relaxed text-midnight">
            <li><strong>Parent Population:</strong> Shows the normal distribution we're sampling from</li>
            <li><strong>Sample Data:</strong> Shows the individual values from your most recent sample</li>
            <li><strong>Distribution of Sample Means:</strong> Shows a histogram of the means from all samples taken.
                This demonstrates the CLT!</li>
        </ol>

        <h3 class="mt-4 text-lg font-semibold text-indigo-deep">üî¨ Central Limit Theorem</h3>
        <p class="text-sm leading-relaxed text-midnight">The CLT states that when you take many samples from a
            population and calculate their means, those means will form a normal distribution, even if the original
            population isn't normal!</p>
        <p class="text-sm leading-relaxed text-midnight"><strong>Key Properties:</strong></p>
        <ul class="list-disc space-y-1 pl-5 text-sm leading-relaxed text-midnight">
            <li>The mean of sample means equals the population mean (Œº)</li>
            <li>The standard deviation of sample means = œÉ/‚àön (called the Standard Error)</li>
            <li>As sample size increases, the distribution becomes more normal and narrower</li>
        </ul>

        <h3 class="mt-4 text-lg font-semibold text-indigo-deep">üí° Try This</h3>
        <ol class="list-decimal space-y-1 pl-5 text-sm leading-relaxed text-midnight">
            <li>Use the default settings (Œº=16, œÉ=5, n=5)</li>
            <li>Click "Play Animation" and watch Graph 3 develop</li>
            <li>Notice how it forms a bell curve centered at 16</li>
            <li>Now increase the sample size to 100 and click "Clear All"</li>
            <li>Run the animation again - the distribution is much narrower!</li>
        </ol>

        <button
            class="mt-6 inline-flex w-full items-center justify-center rounded-lg bg-gradient-to-r from-lime-glow to-violet-royal px-4 py-3 text-sm font-semibold text-midnight shadow-[0_12px_24px_rgba(148,72,176,0.28)] transition hover:-translate-y-0.5 hover:shadow-[0_16px_30px_rgba(148,72,176,0.34)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-royal"
            id="closeHelp">
            Got it!
        </button>
    </div>
</div>

<!-- Load Plotly.js -->
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

<!-- Load our simulation JavaScript -->
<script src="{% static 'stats_simulator/simulator.js' %}?v=2.4"></script>

{% endblock %}