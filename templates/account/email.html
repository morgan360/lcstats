{% extends "_base.html" %}
{% load account %}

{% block title %}Email Addresses | LCAI Maths{% endblock %}

{% block content %}
<div style="max-width: 700px; margin: 60px auto; padding: 20px;">
    <div style="background: white; border-radius: 12px; padding: 40px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <div style="margin-bottom: 30px;">
            <h1 style="color: #004aad; font-size: 2em; margin-bottom: 10px;">Account Settings</h1>
            <p style="color: #666; font-size: 1.1em;">Manage your email addresses</p>
        </div>

        {% if messages %}
            {% for message in messages %}
                <div style="background-color: {% if message.tags == 'error' or message.tags == 'danger' %}#ffebee{% else %}#e8f5e9{% endif %};
                            border: 1px solid {% if message.tags == 'error' or message.tags == 'danger' %}#ef5350{% else %}#66bb6a{% endif %};
                            padding: 12px;
                            border-radius: 6px;
                            margin-bottom: 20px;
                            text-align: center;">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        {% if user.emailaddress_set.all %}
            <div style="margin-bottom: 30px;">
                <h2 style="color: #333; font-size: 1.3em; margin-bottom: 15px;">Your Email Addresses</h2>

                <form method="POST" action="{% url 'account_email' %}">
                    {% csrf_token %}

                    <div style="background-color: #f9f9f9; border-radius: 8px; padding: 20px;">
                        {% for emailaddress in user.emailaddress_set.all %}
                            <div style="background: white; border: 2px solid #e0e0e0; border-radius: 6px; padding: 15px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="radio"
                                               name="email"
                                               value="{{ emailaddress.email }}"
                                               {% if emailaddress.primary %}checked{% endif %}
                                               style="margin-right: 12px; width: 20px; height: 20px; cursor: pointer;">
                                        <div>
                                            <strong style="color: #333; font-size: 1.1em;">{{ emailaddress.email }}</strong>
                                            <div style="margin-top: 5px;">
                                                {% if emailaddress.verified %}
                                                    <span style="background: #4caf50; color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: 600;">‚úì Verified</span>
                                                {% else %}
                                                    <span style="background: #ff9800; color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: 600;">‚ö† Unverified</span>
                                                {% endif %}
                                                {% if emailaddress.primary %}
                                                    <span style="background: #004aad; color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.8em; font-weight: 600; margin-left: 5px;">Primary</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </label>
                                </div>

                                {% if not emailaddress.primary %}
                                    <button type="submit"
                                            name="action_remove"
                                            value="{{ emailaddress.email }}"
                                            onclick="return confirm('Are you sure you want to remove this email address?');"
                                            style="background: #ef5350; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 0.9em;">
                                        Remove
                                    </button>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>

                    <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                        <button type="submit"
                                name="action_primary"
                                style="background: linear-gradient(135deg, #004aad 0%, #0066cc 100%); color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 1em;">
                            Make Primary
                        </button>

                        <button type="submit"
                                name="action_send"
                                style="background: linear-gradient(135deg, #00994c 0%, #00cc66 100%); color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 1em;">
                            Re-send Verification
                        </button>
                    </div>
                </form>
            </div>
        {% else %}
            <div style="background-color: #fff3cd; border: 1px solid #ffc107; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                <strong>‚ö† Warning:</strong> You currently do not have any email addresses set up. Add an email address to enable password recovery.
            </div>
        {% endif %}

        <div style="border-top: 2px solid #f0f0f0; padding-top: 30px; margin-top: 30px;">
            <h2 style="color: #333; font-size: 1.3em; margin-bottom: 15px;">Add Email Address</h2>

            <form method="POST" action="{% url 'account_email' %}">
                {% csrf_token %}

                <div style="margin-bottom: 20px;">
                    <label for="id_email" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">
                        Email Address
                    </label>
                    <input type="email"
                           name="email"
                           id="id_email"
                           placeholder="new.email@example.com"
                           required
                           style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1em; box-sizing: border-box;">
                </div>

                <button type="submit"
                        name="action_add"
                        style="background: linear-gradient(135deg, #00994c 0%, #00cc66 100%); color: white; padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 1em;">
                    Add Email
                </button>
            </form>
        </div>

        <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #f0f0f0;">
            <div style="margin-bottom: 15px;">
                <a href="{% url 'account_change_password' %}" style="display: inline-block; background: #004aad; color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: 600; transition: transform 0.2s;">
                    üîí Change Password
                </a>
            </div>
            <a href="{% url 'dashboard' %}" style="color: #004aad; font-weight: 600; text-decoration: none;">
                ‚Üê Back to Dashboard
            </a>
        </div>
    </div>
</div>

<style>
    input[type="email"]:focus {
        outline: none;
        border-color: #00994c;
    }

    button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
</style>
{% endblock %}