{% extends '_base.html' %}

{% block title %}{{ topic.name }} Flashcards - NumScoil{% endblock %}

{% block content %}
<div class="mx-auto max-w-6xl px-4 py-8 sm:px-6 lg:px-8">
    <!-- Breadcrumbs -->
    <div class="mb-6 text-sm text-mist/70">
        <a href="{% url 'select_topic' %}" class="hover:underline">Topics</a> /
        <span class="text-mist">{{ topic.name }}</span>
    </div>

    <h1 class="mb-3 text-3xl font-semibold text-mist">{{ topic.name }} Flashcards</h1>
    <p class="mb-6 text-lg text-mist/80">
        Practice and master key concepts with interactive flashcards.
    </p>

    <!-- How It Works Box -->
    <div class="mb-10 rounded-2xl border border-indigo-deep/20 bg-indigo-deep/5 p-6">
        <h2 class="mb-4 flex items-center gap-2 text-lg font-semibold text-mist">
            <svg class="h-5 w-5 text-violet-royal" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            How Flashcards Work
        </h2>
        <div class="grid gap-4 text-sm text-mist/80 sm:grid-cols-2 lg:grid-cols-4">
            <div class="flex items-start gap-3">
                <span class="flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-gray-200 text-xs font-bold text-gray-700">1</span>
                <div>
                    <span class="font-semibold text-mist">New cards</span> start with multiple choice to help you learn.
                </div>
            </div>
            <div class="flex items-start gap-3">
                <span class="flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-green-200 text-xs font-bold text-green-800">2</span>
                <div>
                    <span class="font-semibold text-mist">Know cards</span> switch to self-assessment - you reveal the answer and judge yourself.
                </div>
            </div>
            <div class="flex items-start gap-3">
                <span class="flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-purple-200 text-xs font-bold text-purple-800">3</span>
                <div>
                    <span class="font-semibold text-mist">Retired cards</span> are removed from your deck when you get them right by yourself.
                </div>
            </div>
            <div class="flex items-start gap-3">
                <span class="flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-amber-200 text-xs font-bold text-amber-800">4</span>
                <div>
                    <span class="font-semibold text-mist">Reset progress</span> anytime from the Progress page to study again.
                </div>
            </div>
        </div>
    </div>

    {% if sets_with_progress %}
    <div class="grid gap-6 sm:grid-cols-1 lg:grid-cols-2">
        {% for item in sets_with_progress %}
        <div class="group relative flex h-full flex-col rounded-2xl border border-indigo-deep/10 bg-white/90 p-6 shadow-[0_12px_28px_rgba(0,0,0,0.08)] transition hover:-translate-y-1 hover:shadow-[0_18px_38px_rgba(0,0,0,0.12)]">
            <span class="absolute -left-0.5 top-0 h-full w-2.5 rounded-l-2xl bg-gradient-to-b from-violet-royal to-rose-pop"></span>

            <div class="mb-4 flex items-start justify-between gap-3">
                <h2 class="text-xl font-semibold text-midnight">{{ item.set.title }}</h2>
                <span class="inline-flex items-center whitespace-nowrap rounded-full bg-indigo-deep/10 px-3 py-1 text-xs font-semibold text-indigo-deep">
                    {{ item.total_cards }} card{{ item.total_cards|pluralize }}
                </span>
            </div>

            {% if item.set.description %}
            <p class="mb-4 text-sm leading-relaxed text-indigo-deep/80">
                {{ item.set.description }}
            </p>
            {% endif %}

            <!-- Progress Bar -->
            <div class="mb-4">
                <div class="mb-2 flex items-center justify-between text-xs font-semibold text-indigo-deep/70">
                    <span>Progress</span>
                    <span>{{ item.progress_pct|floatformat:0 }}% Mastered</span>
                </div>
                <div class="h-2 w-full overflow-hidden rounded-full bg-gray-200">
                    <div class="h-full rounded-full bg-gradient-to-r from-green-400 to-green-600 transition-all duration-300" style="width: {{ item.progress_pct }}%"></div>
                </div>
            </div>

            <!-- Mastery Breakdown -->
            <div class="mb-6 grid grid-cols-5 gap-2 text-center text-xs">
                <div class="rounded-lg bg-gray-100 px-2 py-2">
                    <div class="font-bold text-gray-700">{{ item.mastery_counts.new }}</div>
                    <div class="text-gray-600">New</div>
                </div>
                <div class="rounded-lg bg-yellow-100 px-2 py-2">
                    <div class="font-bold text-yellow-800">{{ item.mastery_counts.learning }}</div>
                    <div class="text-yellow-700">Learning</div>
                </div>
                <div class="rounded-lg bg-green-100 px-2 py-2">
                    <div class="font-bold text-green-800">{{ item.mastery_counts.know }}</div>
                    <div class="text-green-700">Know</div>
                </div>
                <div class="rounded-lg bg-red-100 px-2 py-2">
                    <div class="font-bold text-red-800">{{ item.mastery_counts.dont_know }}</div>
                    <div class="text-red-700">Don't Know</div>
                </div>
                <div class="rounded-lg bg-purple-100 px-2 py-2">
                    <div class="font-bold text-purple-800">{{ item.mastery_counts.retired }}</div>
                    <div class="text-purple-700">Retired</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mt-auto flex gap-3">
                <a href="{% url 'flashcards:study_set' topic.slug item.set.id %}"
                    class="flex-1 rounded-lg bg-gradient-to-r from-rose-pop to-violet-royal px-4 py-2 text-center text-sm font-semibold text-mist shadow-[0_12px_24px_rgba(148,72,176,0.28)] transition hover:-translate-y-0.5 hover:shadow-[0_16px_30px_rgba(148,72,176,0.34)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-royal">
                    Study Cards
                </a>
                <a href="{% url 'flashcards:set_progress' topic.slug item.set.id %}"
                    class="flex-1 rounded-lg border-2 border-violet-royal px-4 py-2 text-center text-sm font-semibold text-violet-royal transition hover:bg-violet-royal hover:text-mist focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-royal">
                    View Progress
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="mt-10 rounded-2xl border border-indigo-deep/20 bg-mist px-6 py-12 text-center shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
        <p class="text-lg font-semibold text-midnight">No flashcard sets available for this topic yet.</p>
        <p class="text-indigo-deep/70">Check back soon for new content!</p>
    </div>
    {% endif %}
</div>
{% endblock %}
