{% extends "_base.html" %}

{% block content %}
{% include "homework/notification_modal.html" %}
<div style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
    <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">Welcome, {{ profile.user.username }}!</h2>

    <!-- Homework Summary (if any) -->
    {% if homework_count > 0 %}
    <div style="background: {% if overdue_homework %}#fee{% else %}#f0f9ff{% endif %}; padding: 1.5rem; border-radius: 8px; margin-bottom: 2rem; border-left: 4px solid {% if overdue_homework %}#e74c3c{% else %}#3498db{% endif %};">
        <h3 style="margin: 0 0 1rem 0; color: #2c3e50;">üìö Homework</h3>

        {% if overdue_homework %}
        <div style="margin-bottom: 1rem;">
            <p style="margin: 0 0 0.5rem 0; color: #e74c3c; font-weight: bold;">‚ö†Ô∏è {{ overdue_homework|length }} overdue assignment{{ overdue_homework|length|pluralize }}</p>
            {% for hw in overdue_homework %}
            <p style="margin: 0.3rem 0; color: #555;">
                ‚Ä¢ <a href="{% url 'homework:assignment_detail' hw.id %}" style="color: #e74c3c; text-decoration: none; font-weight: bold;">{{ hw.title }}</a> (due {{ hw.due_date|date:"M d" }})
            </p>
            {% endfor %}
        </div>
        {% endif %}

        {% if upcoming_homework %}
        <div>
            <p style="margin: 0 0 0.5rem 0; color: #2c3e50; font-weight: bold;">Upcoming:</p>
            {% for hw in upcoming_homework %}
            <p style="margin: 0.3rem 0; color: #555;">
                ‚Ä¢ <a href="{% url 'homework:assignment_detail' hw.id %}" style="color: #3498db; text-decoration: none;">{{ hw.title }}</a> (due {{ hw.due_date|date:"M d" }})
            </p>
            {% endfor %}
        </div>
        {% endif %}

        <a href="{% url 'homework:student_dashboard' %}" style="display: inline-block; margin-top: 1rem; background: #3498db; color: white; padding: 0.6rem 1.2rem; border-radius: 5px; text-decoration: none; font-weight: bold;">
            View All Homework ‚Üí
        </a>
    </div>
    {% endif %}

    <!-- Stats Grid -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
            <p style="margin: 0; color: #7f8c8d; font-size: 0.9rem;">Total Attempts</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 2rem; font-weight: bold; color: #2c3e50;">{{ total_attempts }}</p>
        </div>
        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
            <p style="margin: 0; color: #7f8c8d; font-size: 0.9rem;">Accuracy</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 2rem; font-weight: bold; color: #2ecc71;">{{ accuracy }}%</p>
        </div>
        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
            <p style="margin: 0; color: #7f8c8d; font-size: 0.9rem;">Total Score</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 2rem; font-weight: bold; color: #3498db;">{{ profile.total_score|floatformat:1 }}</p>
        </div>
        <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
            <p style="margin: 0; color: #7f8c8d; font-size: 0.9rem;">Lessons Completed</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 2rem; font-weight: bold; color: #f39c12;">{{ profile.lessons_completed }}</p>
        </div>
    </div>

    <!-- Recent Attempts -->
    <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 2rem;">
        <h3 style="margin: 0 0 1rem 0; color: #2c3e50;">Recent Attempts</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #f8f9fa; border-bottom: 2px solid #ddd;">
                <th style="padding: 0.8rem; text-align: left;">Question</th>
                <th style="padding: 0.8rem; text-align: left;">Topic</th>
                <th style="padding: 0.8rem; text-align: center;">Score</th>
                <th style="padding: 0.8rem; text-align: center;">Result</th>
            </tr>
            {% for a in recent_attempts %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 0.8rem;">{{ a.question.text|truncatechars:40 }}</td>
                <td style="padding: 0.8rem;">{{ a.question.topic.name }}</td>
                <td style="padding: 0.8rem; text-align: center;">{{ a.score_awarded|floatformat:1 }}</td>
                <td style="padding: 0.8rem; text-align: center; font-size: 1.2rem;">{% if a.is_correct %}‚úÖ{% else %}‚ùå{% endif %}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <!-- Performance by Topic -->
    <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h3 style="margin: 0 0 1rem 0; color: #2c3e50;">Performance by Topic</h3>
        <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #f8f9fa; border-bottom: 2px solid #ddd;">
                <th style="padding: 0.8rem; text-align: left;">Topic</th>
                <th style="padding: 0.8rem; text-align: center;">Attempts</th>
                <th style="padding: 0.8rem; text-align: center;">Avg Score</th>
                <th style="padding: 0.8rem; text-align: center;">Correct</th>
            </tr>
            {% for t in topic_summary %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 0.8rem;">{{ t.question__topic__name }}</td>
                <td style="padding: 0.8rem; text-align: center;">{{ t.attempts }}</td>
                <td style="padding: 0.8rem; text-align: center;">{{ t.avg_score|floatformat:1 }}</td>
                <td style="padding: 0.8rem; text-align: center;">{{ t.correct }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
{% endblock %}
