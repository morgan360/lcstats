{% extends "_base.html" %}

{% block content %}
{% include "homework/notification_modal.html" %}
<div class="mx-auto max-w-6xl px-4 py-8 sm:px-6 lg:px-8">
    <h2 class="mb-6 text-2xl font-semibold text-midnight">Welcome, {{ profile.user.username }}!</h2>

    <!-- Homework Summary (if any) -->
    {% if homework_count > 0 %}
    <div class="mb-8 rounded-2xl border border-indigo-deep/10 bg-white/90 p-5 shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
        <h3 class="mb-4 text-xl font-semibold text-midnight">üìö Homework</h3>

        {% if overdue_homework %}
        <div class="mb-3">
            <p class="mb-2 text-sm font-semibold text-rose-pop">‚ö†Ô∏è {{ overdue_homework|length }} overdue assignment{{ overdue_homework|length|pluralize }}</p>
            {% for hw in overdue_homework %}
            <p class="my-1 text-sm text-indigo-deep/80">
                ‚Ä¢ <a href="{% url 'homework:assignment_detail' hw.id %}" class="font-semibold text-rose-pop hover:text-rose-pop/80">{{ hw.title }}</a>
                (due {{ hw.due_date|date:"M d" }})
            </p>
            {% endfor %}
        </div>
        {% endif %}

        {% if upcoming_homework %}
        <div>
            <p class="mb-2 text-sm font-semibold text-midnight">Upcoming:</p>
            {% for hw in upcoming_homework %}
            <p class="my-1 text-sm text-indigo-deep/80">
                ‚Ä¢ <a href="{% url 'homework:assignment_detail' hw.id %}" class="font-semibold text-violet-royal hover:text-indigo-deep">{{ hw.title }}</a>
                (due {{ hw.due_date|date:"M d" }})
            </p>
            {% endfor %}
        </div>
        {% endif %}

        <a href="{% url 'homework:student_dashboard' %}"
           class="mt-4 inline-flex items-center gap-2 rounded-lg bg-gradient-03 px-4 py-2 text-sm font-semibold text-mist shadow-[0_12px_24px_rgba(148,72,176,0.28)] transition hover:-translate-y-0.5 hover:shadow-[0_16px_30px_rgba(148,72,176,0.34)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-royal">
            View All Homework ‚Üí
        </a>
    </div>
    {% endif %}

    <!-- Stats Grid -->
    <div class="mb-8 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
        <div class="rounded-2xl border border-indigo-deep/10 bg-white/90 p-5 text-center shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
            <p class="text-sm font-semibold text-indigo-deep/70">Total Attempts</p>
            <p class="mt-2 text-3xl font-bold text-midnight">{{ total_attempts }}</p>
        </div>
        <div class="rounded-2xl border border-indigo-deep/10 bg-white/90 p-5 text-center shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
            <p class="text-sm font-semibold text-indigo-deep/70">Accuracy</p>
            <p class="mt-2 text-3xl font-bold text-rose-pop">{{ accuracy }}%</p>
        </div>
        <div class="rounded-2xl border border-indigo-deep/10 bg-white/90 p-5 text-center shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
            <p class="text-sm font-semibold text-indigo-deep/70">Total Score</p>
            <p class="mt-2 text-3xl font-bold text-violet-royal">{{ profile.total_score|floatformat:1 }}</p>
        </div>
        <div class="rounded-2xl border border-indigo-deep/10 bg-white/90 p-5 text-center shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
            <p class="text-sm font-semibold text-indigo-deep/70">Lessons Completed</p>
            <p class="mt-2 text-3xl font-bold text-amber-400">{{ profile.lessons_completed }}</p>
        </div>
    </div>

    <!-- Recent Attempts -->
    <div class="mb-8 rounded-2xl border border-indigo-deep/10 bg-white/90 p-5 shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
        <h3 class="mb-4 text-xl font-semibold text-midnight">Recent Attempts</h3>
        <div class="overflow-hidden rounded-xl border border-indigo-deep/10">
            <table class="w-full text-sm">
                <thead class="bg-mist text-left text-indigo-deep/80">
                    <tr>
                        <th class="px-4 py-3">Question</th>
                        <th class="px-4 py-3">Topic</th>
                        <th class="px-4 py-3 text-center">Score</th>
                        <th class="px-4 py-3 text-center">Result</th>
                    </tr>
                </thead>
                <tbody>
                    {% for a in recent_attempts %}
                    <tr class="border-t border-indigo-deep/10 text-midnight">
                        <td class="px-4 py-3">{{ a.question.text|truncatechars:40 }}</td>
                        <td class="px-4 py-3">{{ a.question.topic.name }}</td>
                        <td class="px-4 py-3 text-center font-semibold">{{ a.score_awarded|floatformat:1 }}</td>
                        <td class="px-4 py-3 text-center text-lg">{% if a.is_correct %}‚úÖ{% else %}‚ùå{% endif %}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Performance by Topic -->
    <div class="rounded-2xl border border-indigo-deep/10 bg-white/90 p-5 shadow-[0_12px_28px_rgba(0,0,0,0.08)]">
        <h3 class="mb-4 text-xl font-semibold text-midnight">Performance by Topic</h3>
        <div class="overflow-hidden rounded-xl border border-indigo-deep/10">
            <table class="w-full text-sm">
                <thead class="bg-mist text-left text-indigo-deep/80">
                    <tr>
                        <th class="px-4 py-3">Topic</th>
                        <th class="px-4 py-3 text-center">Attempts</th>
                        <th class="px-4 py-3 text-center">Avg Score</th>
                        <th class="px-4 py-3 text-center">Correct</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in topic_summary %}
                    <tr class="border-t border-indigo-deep/10 text-midnight">
                        <td class="px-4 py-3">{{ t.question__topic__name }}</td>
                        <td class="px-4 py-3 text-center">{{ t.attempts }}</td>
                        <td class="px-4 py-3 text-center">{{ t.avg_score|floatformat:1 }}</td>
                        <td class="px-4 py-3 text-center">{{ t.correct }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
