{% extends "_base.html" %}

{% block title %}Exam Papers - NumScoil{% endblock %}

{% block content %}
<div class="mx-auto max-w-6xl px-4 py-8 text-midnight">
    <h1 class="text-2xl font-semibold text-mist text-center">Leaving Certificate Exam Papers</h1>
    <p class="mt-4 rounded-xl border border-indigo-deep/20 bg-mist px-5 py-4 text-sm text-indigo-deep shadow-[0_8px_24px_rgba(0,0,0,0.08)]">
        Practice with real Leaving Certificate exam papers under exam conditions with a <strong>150-minute timer</strong>.
        <br><strong>ðŸ’¡ Want to practice individual questions?</strong> Go to
        <a href="{% url 'select_topic' %}" class="font-semibold text-violet-royal hover:text-indigo-deep">Interactive Lessons</a>
        and click "Exam Questions" for any topic.
    </p>

    <section class="mt-10">
        <h2 class="mb-4 text-xl font-semibold text-mist">Available Papers</h2>

        {% if papers_by_year %}
        <div class="overflow-hidden rounded-xl border border-indigo-deep/15 bg-mist shadow-[0_10px_30px_rgba(0,0,0,0.08)]">
        <table class="w-full border-collapse text-sm">
            <thead class="bg-[linear-gradient(135deg,#667eea_0%,#764ba2_100%)] text-white">
                <tr>
                    <th class="px-4 py-3 text-left font-semibold">Year</th>
                    <th class="px-4 py-3 text-left font-semibold">Paper</th>
                    <th class="px-4 py-3 text-left font-semibold">Questions</th>
                    <th class="px-4 py-3 text-left font-semibold">Time</th>
                    <th class="px-4 py-3 text-left font-semibold">Marking Scheme</th>
                    <th class="px-4 py-3 text-left font-semibold">Progress</th>
                    <th class="px-4 py-3 text-left font-semibold">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for year, papers in papers_by_year.items %}
                {% for paper in papers %}
                <tr class="transition hover:bg-mist/80 last:[&>td]:border-b-0">
                    <td class="border-b border-indigo-deep/10 px-4 py-3"><strong>{{ year }}</strong></td>
                    <td class="border-b border-indigo-deep/10 px-4 py-3">{{ paper.get_paper_type_display }}</td>
                    <td class="border-b border-indigo-deep/10 px-4 py-3">{{ paper.questions.count }} questions ({{ paper.total_marks }} marks)</td>
                    <td class="border-b border-indigo-deep/10 px-4 py-3">{{ paper.time_limit_minutes }} min</td>
                    <td class="border-b border-indigo-deep/10 px-4 py-3">
                        {% if paper.marking_scheme_pdf %}
                            <a href="{{ paper.marking_scheme_pdf.url }}" target="_blank" class="inline-flex items-center rounded-lg bg-gradient-to-b from-violet-royal to-indigo-deep px-4 py-2 text-sm font-semibold text-mist shadow-[0_6px_20px_rgba(0,0,0,0.15)] transition hover:-translate-y-0.5 hover:shadow-[0_10px_26px_rgba(0,0,0,0.2)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-lime-glow">
                                ðŸ“„ View
                            </a>
                        {% else %}
                            <span class="text-indigo-deep/60">â€”</span>
                        {% endif %}
                    </td>
                    <td class="border-b border-indigo-deep/10 px-4 py-3">
                        {% if paper.active_attempt %}
                            <span class="inline-flex items-center rounded-full bg-rose-pop/40 px-3 py-1 text-xs font-semibold text-midnight">In Progress</span>
                        {% elif paper.completed_attempt %}
                            <span class="inline-flex items-center rounded-full bg-lime-glow/70 px-3 py-1 text-xs font-semibold text-midnight">
                                âœ“ {{ paper.completed_attempt.percentage_score|floatformat:0 }}%
                            </span>
                        {% else %}
                            <span class="inline-flex items-center rounded-full bg-indigo-deep/10 px-3 py-1 text-xs font-semibold text-indigo-deep">Not Started</span>
                        {% endif %}
                    </td>
                    <td class="border-b border-indigo-deep/10 px-4 py-3">
                        {% if paper.active_attempt %}
                            <a href="{% url 'exam_papers:question_interface' paper.active_attempt.id paper.active_attempt.exam_paper.questions.first.id %}" class="inline-flex items-center rounded-lg bg-gradient-03 px-4 py-2 text-sm font-semibold text-mist shadow-[0_10px_26px_rgba(148,72,176,0.3)] transition hover:-translate-y-0.5 hover:shadow-[0_14px_32px_rgba(148,72,176,0.4)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-violet-royal">
                                Resume Exam â†’
                            </a>
                        {% else %}
                            <form method="post" action="{% url 'exam_papers:start_paper_attempt' paper.slug %}" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="mode" value="full_timed">
                                <button type="submit" class="inline-flex items-center rounded-lg bg-gradient-04 px-4 py-2 text-sm font-semibold text-mist shadow-[0_10px_26px_rgba(0,0,0,0.2)] transition hover:-translate-y-0.5 hover:shadow-[0_14px_32px_rgba(0,0,0,0.3)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-lime-glow">
                                    Start Exam â†’
                                </button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
                {% endfor %}
            </tbody>
        </table>
        </div>
        {% else %}
        <p class="rounded-xl border border-indigo-deep/15 bg-mist px-6 py-10 text-center text-sm text-indigo-deep/70">
            No exam papers available yet. Check back soon!
        </p>
        {% endif %}
    </section>
</div>
{% endblock %}
