{% extends "_base.html" %}

{% block title %}{{ teacher_class.name }} - Weekly Homework Report{% endblock %}

{% block content %}
<div class="container" style="max-width: 1400px; margin: 2rem auto; padding: 0 1rem;">
    <div class="no-print" style="margin-bottom: 1rem;">
        <a href="{% url 'homework:class_detail' teacher_class.id %}" style="color: #3498db; text-decoration: none;">← Back to Class</a>
        <button onclick="window.print()" style="float: right; background: #3498db; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer;">
            Print Report
        </button>
    </div>

    <div class="report-header" style="margin-bottom: 2rem;">
        <h1 style="color: #2c3e50; margin: 0.5rem 0;">Weekly Homework Report</h1>
        <h2 style="color: #7f8c8d; font-size: 1.2rem; font-weight: normal; margin: 0.25rem 0;">{{ teacher_class.name }}</h2>
        <p style="color: #95a5a6; font-size: 0.9rem; margin: 0.25rem 0;">
            Week: {{ week_start|date:"M d, Y" }} - {{ week_end|date:"M d, Y" }}
        </p>
        <p style="color: #95a5a6; font-size: 0.9rem; margin: 0.25rem 0;">
            Generated: {{ current_date|date:"M d, Y g:i A" }}
        </p>
    </div>

    {% if report_data %}
    <div style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">
            <thead>
                <tr style="background: #2c3e50; color: white;">
                    <th style="padding: 0.75rem; text-align: left; border: 1px solid #34495e; min-width: 200px;">
                        Homework Title
                    </th>
                    <th style="padding: 0.75rem; text-align: center; border: 1px solid #34495e; min-width: 90px;">
                        Due Date
                    </th>
                    {% for student_info in students_with_initials %}
                    <th style="padding: 0.75rem; text-align: center; border: 1px solid #34495e; min-width: 50px; max-width: 60px;" title="{{ student_info.full_name }}">
                        {{ student_info.initials }}
                    </th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in report_data %}
                <tr {% if forloop.counter|divisibleby:2 %}style="background: #f8f9fa;"{% endif %}>
                    <td style="padding: 0.75rem; border: 1px solid #bdc3c7;">
                        {{ row.assignment.title }}
                        <br>
                        <small style="color: #7f8c8d;">({{ row.total_tasks }} task{{ row.total_tasks|pluralize }})</small>
                    </td>
                    <td style="padding: 0.75rem; text-align: center; border: 1px solid #bdc3c7; white-space: nowrap;">
                        {{ row.assignment.due_date|date:"M d" }}
                    </td>
                    {% for student_status in row.student_statuses %}
                    <td style="padding: 0.5rem; text-align: center; border: 1px solid #bdc3c7; font-size: 0.75rem; font-weight: bold;" class="status-{{ student_status.status_class }}">
                        {% if student_status.status == 'Submitted' %}
                            <span style="color: #27ae60;">S</span>
                        {% elif student_status.status == 'Completed' %}
                            <span style="color: #2ecc71;">C</span>
                        {% elif student_status.status == 'In Progress' %}
                            <span style="color: #f39c12;">P</span>
                        {% else %}
                            <span style="color: #e74c3c;">—</span>
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #ecf0f1;">
            <h3 style="font-size: 0.9rem; color: #34495e; margin-bottom: 0.5rem; font-weight: bold;">Status Legend:</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.75rem;">
                <div>
                    <span style="color: #27ae60; font-weight: bold;">S</span> = Submitted
                </div>
                <div>
                    <span style="color: #2ecc71; font-weight: bold;">C</span> = Completed (not submitted)
                </div>
                <div>
                    <span style="color: #f39c12; font-weight: bold;">P</span> = In Progress
                </div>
                <div>
                    <span style="color: #e74c3c; font-weight: bold;">—</span> = Not Started
                </div>
            </div>
        </div>

        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #ecf0f1;">
            <h3 style="font-size: 0.9rem; color: #34495e; margin-bottom: 0.5rem; font-weight: bold;">Student Initials:</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; font-size: 0.85rem;">
                {% for student_info in students_with_initials %}
                <div>
                    <strong>{{ student_info.initials }}</strong> = {{ student_info.full_name }}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% else %}
    <div style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center;">
        <p style="color: #7f8c8d; margin: 0;">No homework assignments due this week for this class.</p>
    </div>
    {% endif %}
</div>

<style>
    /* Print styles */
    @media print {
        .no-print {
            display: none !important;
        }

        body {
            font-size: 10pt;
        }

        .container {
            max-width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        table {
            font-size: 8pt !important;
            page-break-inside: auto;
        }

        tr {
            page-break-inside: avoid;
            page-break-after: auto;
        }

        thead {
            display: table-header-group;
        }

        h1 {
            font-size: 16pt;
        }

        h2 {
            font-size: 12pt;
        }

        /* Ensure colors print */
        * {
            -webkit-print-color-adjust: exact !important;
            print-color-adjust: exact !important;
        }
    }

    /* Screen styles */
    @media screen {
        /* Hover effect for rows */
        tbody tr:hover {
            background: #e8f4f8 !important;
        }
    }
</style>
{% endblock %}